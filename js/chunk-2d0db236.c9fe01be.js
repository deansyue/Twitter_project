(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0db236"],{"6f1a":function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isLoading?s("img",{staticClass:"spinner"}):s("div",[s("div",{staticClass:"tweet-wrapper"},[s("div",{staticClass:"tweet-title"},[s("img",{staticClass:"arrow",on:{click:function(e){return t.$router.back()}}}),s("h3",[t._v("推文")])]),s("div",{staticClass:"tweet-main"},[s("div",{staticClass:"card-head"},[s("div",{staticClass:"card-head-left avatar",on:{click:function(e){return t.linkedUser(t.user.id)}}},[s("img",{staticClass:"avatar",attrs:{src:t._f("emptyImage")(t.user.avatar)}})]),s("div",{staticClass:"card-head-right"},[s("h5",{on:{click:function(e){return t.linkedUser(t.user.id)}}},[t._v(t._s(t.user.name))]),s("h5",[t._v(t._s(t._f("accountTag")(t.user.account)))])])]),s("div",{staticClass:"tweet-body"},[s("p",[t._v(t._s(t.repliedTweet.description))]),s("h5",[t._v(t._s(t._f("timeFormat")(t.repliedTweet.createdAt)))])]),s("div",{staticClass:"tweet-footer"},[s("div",{staticClass:"tweet-footer-info"},[s("h4",[s("strong",[t._v(t._s(t.replyCards.length))]),t._v(" 回覆 ")]),s("h4",[s("strong",[t._v(t._s(t.repliedTweet.likeCount))]),t._v(" 喜歡次數 ")])]),s("div",{staticClass:"tweet-footer-buttons"},[s("img",{staticClass:"reply-big",on:{click:function(e){return t.showReplyModal()}}}),t.repliedTweet.isLiked?s("img",{staticClass:"heart-big-active",on:{click:function(e){return t.deleteLike()}}}):s("img",{staticClass:"heart-big",on:{click:function(e){return t.addLike()}}})])])])]),t._l(t.replyCards,(function(e){return s("div",{key:e.id,staticClass:"tweet-replies"},[s("TweetReplyCard",{attrs:{"reply-target":t.user,"reply-card":e}})],1)}))],2)])},a=[],i=(s("d9e2"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tweetReplyCard-wrapper"},[s("div",{staticClass:"card-left avatar",on:{click:function(e){return t.linkedUser(t.userId)}}},[s("img",{staticClass:"avatar",attrs:{src:t._f("emptyImage")(t.avatar)}})]),s("div",{staticClass:"card-right"},[s("div",{staticClass:"card-head"},[s("h5",{staticClass:"card-name",on:{click:function(e){return t.linkedUser(t.userId)}}},[t._v(" "+t._s(t.userName)+" ")]),s("h5",{staticClass:"card-account"},[t._v(" "+t._s(t._f("accountTag")(t.userAccount))+" ")]),s("span",[t._v("．")]),s("h5",{staticClass:"card-time"},[t._v(" "+t._s(t._f("fromNow")(t.createdAt))+" ")])]),s("h5",[s("span",[t._v("回覆")]),s("span",{staticClass:"card-replyer",on:{click:function(e){return t.linkedUser(t.targetUserId)}}},[t._v(" "+t._s(t._f("accountTag")(t.targetAccount))+" ")])]),s("p",[t._v(t._s(t.comment))])])])}),c=[],d=s("2708"),n=s("2f62"),o={mixins:[d["c"],d["a"],d["b"]],props:{replyTarget:{type:Object,required:!0},replyCard:{type:Object,required:!0}},data(){return{targetAccount:"",targetUserId:0,tweetId:0,userId:0,comment:"",createdAt:"",userName:"",userAccount:"",avatar:""}},computed:{...Object(n["b"])(["currentUser"])},methods:{fetchReplyCard(){this.targetAccount=this.replyTarget.account,this.targetUserId=this.replyTarget.id;const{id:t,comment:e,createdAt:s,UserId:r,User:a}=this.replyCard;this.tweetId=t,this.userId=r,this.comment=e,this.createdAt=s,this.userName=a.name,this.userAccount=a.account,this.avatar=a.avatar},linkedUser(t){t===this.currentUser.id?this.$router.push({name:"self"}):this.$router.push({name:"other",params:{id:t}})}},created(){this.fetchReplyCard()},watch:{replyCard(t){this.replyCard=t,this.fetchReplyCard()},replyTarget(t){this.replyTarget=t,this.fetchReplyCard()}}},l=o,h=s("2877"),u=Object(h["a"])(l,i,c,!1,null,null,null),p=u.exports,m=s("6783"),w=s("2fa3"),f={name:"Tweet",components:{TweetReplyCard:p},mixins:[d["a"],d["f"],d["b"]],computed:{...Object(n["b"])(["currentUser","replyCreate"])},data(){return{paramsId:0,user:{},repliedTweet:{},replyCards:[],isLoading:!1,isProcessing:!1}},methods:{async fetchRepliedTweet(t){try{this.isLoading=!0;const{data:e,statusText:s}=await m["a"].getRepliedTweet({tweetId:t});if("OK"!==s)throw new Error(s);this.isLoading=!1,this.user=e.User,this.repliedTweet={...e}}catch(e){this.isLoading=!1,w["a"].fire({icon:"error",title:"無法取得推文內容，請稍後再試"})}},async fetchTweetReplyCards(t){try{this.isLoading=!0;const{data:e,statusText:s}=await m["a"].getAllReplies({tweetId:t});if("OK"!==s)throw new Error(s);this.isLoading=!1,this.replyCards=[...e]}catch(e){this.isLoading=!1,w["a"].fire({icon:"error",title:"無法取得回覆推文，請稍後再試"})}},afterSubmitReplyCreate(t){this.replyCards.unshift({comment:t.comment,id:t.id,createdAt:t.createdAt,User:{avatar:this.currentUser.avatar,account:this.currentUser.account,name:this.currentUser.name}})},async addLike(){try{this.isProcessing=!0;const{statusText:t,data:e}=await m["a"].addLike({tweetId:this.paramsId});if("OK"!==t||"success"!==e.status)throw new Error(t);this.isProcessing=!1,this.repliedTweet.isLiked=!0,this.repliedTweet.likeCount++}catch(t){this.isProcessing=!1,w["a"].fire({icon:"error",title:"無法加入最愛，請稍後再試"})}},async deleteLike(){try{this.isProcessing=!0;const{statusText:t,data:e}=await m["a"].deleteLike({tweetId:this.paramsId});if("OK"!==t||"success"!==e.status)throw new Error(t);this.isProcessing=!1,this.repliedTweet.isLiked=!1,this.repliedTweet.likeCount--}catch(t){this.isProcessing=!1,w["a"].fire({icon:"error",title:"無法取消最愛，請稍後再試"})}},linkedUser(t){t===this.currentUser.id?this.$router.push({name:"self"}):this.$router.push({name:"other",params:{id:t}})},showReplyModal(){this.$modal.show("replyCreate");const{id:t,User:e,description:s,createdAt:r}=this.repliedTweet,a={id:t,name:e.name,userId:e.id,account:e.account,avatar:e.avatar,description:s,createdAt:r};this.$store.commit("setTweetReplyTarget",a)}},created(){const{id:t}=this.$route.params;this.paramsId=Number(t),this.fetchRepliedTweet(this.paramsId),this.fetchTweetReplyCards(this.paramsId)},beforeRouteUpdate(t,e,s){const{id:r}=t.params;this.paramsId=Number(r),this.fetchRepliedTweet(this.paramsId),this.fetchTweetReplyCards(this.paramsId),s()},watch:{replyCreate(t){this.afterSubmitReplyCreate(t)}}},C=f,g=Object(h["a"])(C,r,a,!1,null,null,null);e["default"]=g.exports}}]);
//# sourceMappingURL=chunk-2d0db236.c9fe01be.js.map